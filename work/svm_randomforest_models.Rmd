---
title: "models_svm_randomforest"
author: "Sarah"
date: "11/8/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

```{r}
# load data
pixels_data <- read.csv('pixels_data.csv')
pixels_data <- pixels_data %>%
  dplyr::select(ID, red, green, blue, ir, ndvi, Cmmn_Nm)
  #dplyr::select(-St_Wdth)

# training data
train <- sample(1:nrow(pixels_data), nrow(pixels_data)/2)

# test data
test <- pixels_data[-train, "Cmmn_Nm"]


# try grouping maples, maybe new smaller polygons, look into overlapping model results in pixels space, make a map of where western redcedar is
```

```{r}
library(randomForest)
set.seed(123)
tree_name_rf <- randomForest(formula = Cmmn_Nm ~ ., data = pixels_data %>% dplyr::select(-ID), subset = train, importance = T)
# default uses mtry = sqrt(# variables) when building random forest of classification trees

tree_name_rf
yhat_rf <- predict(tree_name_rf, newdata = pixels_data[-train, ])
confusion_matrix <- table(test, yhat_rf)

importance(tree_name_rf)
varImpPlot(tree_name_rf)
```

```{r}
library(e1071)
tree_name_svm <- svm(factor(Cmmn_Nm) ~ ., data = pixels_data)

tree_name_svm
summary(tree_name_svm)

graphics::plot(tree_name_svm, pixels_data, factor(Cmmn_Nm) ~ .)

# cross validation
tune_out <- tune(svm, Cmmn_Nm ~., data = pixels_data, kernel = "radial", 
                 ranges = list(cost = c(0.001, 0.01, 0.1, 1, 5, 10, 100)))
summary(tune_out)

# predict

```

Plot results
```{r}
# combine predictions with test data
test_dat <- cbind(yhat_rf, pixels_data[-train, ])

# "accurate" tree guess if more than half pixels in polygon are accurately predicted
poly_test_dat <- test_dat %>%
  group_by(ID) %>%
  count(ID, same = (yhat_rf == Cmmn_Nm), total = n())

poly_test_vector <- poly_test_dat %>%
  dplyr::filter(n/total >= 0.5) %>%
  dplyr::select(ID, same)

poly_test_vector %>%
  group_by(same) %>%
  count(same)

# combine with latitude info
poly_test_join <- sp::merge(poly_join_reprojected, poly_test_vector, duplicateGeoms = T)

plot(poly_test_join, col = c("maroon", "blue")[poly_test_join$same])

```

